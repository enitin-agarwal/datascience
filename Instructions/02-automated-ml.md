---
lab:
    title: '자동화된 Machine Learning 사용'
---

# 자동화된 Machine Learning 사용

Azure Machine Learning에는 클라우드 컴퓨팅의 확장성을 활용하여 데이터에 가장 적합한 감독형 기계 학습 모델을 찾기 위해 동시에 여러 전처리 기술과 모델 학습 알고리즘을 자동으로 시도하는 *자동화된 Machine Learning* 기능이 포함되어 있습니다.

이 연습에서는 Azure Machine Learning Studio에서 자동화된 Machine Learning용 시각적 인터페이스를 사용해 봅니다.

> **참고**: Azure Machine Learning SDK를 통해 자동화된 Machine Learning을 사용할 수도 있습니다.

## 시작하기 전 주의 사항

*[Azure Machine Learning 작업 영역 만들기](01-create-a-workspace.md)* 연습을 아직 완료하지 않았으면 해당 연습을 완료하여 Azure Machine Learning 작업 영역과 컴퓨팅 인스턴스를 만들고 이 연습에 필요한 Notebook을 복제합니다.

## 컴퓨팅 리소스 구성

자동화된 Machine Learning을 사용하려면 모델 학습 실험을 실행할 컴퓨팅 리소스가 필요합니다.

1. Azure 구독과 연결된 Microsoft 자격 증명을 사용하여 [Azure Machine Learning Studio](https://ml.azure.com?azure-portal=true)에 로그인한 다음 Azure Machine Learning 작업 영역을 선택합니다.
2. Azure Machine Learning Studio에서 **컴퓨팅** 페이지를 표시하고 **컴퓨팅 인스턴스** 탭에서 컴퓨팅 인스턴스가 아직 실행되고 있지 않으면 인스턴스를 시작합니다. 이 컴퓨팅 인스턴스를 사용하여 학습시킨 모델을 테스트합니다.
3. 컴퓨팅 인스턴스가 시작되는 동안 **컴퓨팅 클러스터** 탭으로 전환한 후 다음 설정을 사용하여 새 컴퓨팅 클러스터를 추가합니다. 여러 컴퓨팅 노드로 학습 실행을 분산하는 기능을 활용하기 위해 이 클러스터에서 자동화된 Machine Learning 실험을 실행합니다.
    - **지역**: *작업 영역과 같은 지역*
    - **가상 머신 우선 순위**: 전용
    - **가상 머신 유형**: CPU
    - **가상 머신 크기**: Standard_DS11_v2
    - **컴퓨팅 이름**: *고유한 이름 입력*
    - **최소 노드 수**: 0
    - **최대 노드 수**: 2
    - **스케일 다운 전 유휴 시간(초)**: 120
    - **SSH 액세스 사용**: 선택 안 함

## 데이터 세트 만들기

이제 데이터를 처리하는 데 사용할 수 있는 컴퓨팅 리소스를 만들었으므로 처리할 데이터를 저장하고 수집할 방법을 결정해야 합니다.

1. Azure Machine Learning Studio에서 **데이터 세트** 페이지를 확인합니다. 데이터 세트는 Azure ML에서 사용하려는 특정 데이터 파일 또는 테이블을 나타냅니다.
3. 다음 설정을 사용하여 웹 파일에서 새 데이터 세트를 만듭니다.
    * **기본 정보**:
        * **웹 URL**: https://aka.ms/diabetes-data
        * **이름**: diabetes dataset
        * **데이터 세트 형식**: 테이블 형식
        * **설명**: 당뇨병 데이터
    * **설정 및 미리 보기**:
        * **파일 형식**: 구분 기호로 분리됨
        * **구분 기호**: 쉼표
        * **인코딩**: UTF-8
        * **열 헤더**: 첫 번째 파일의 헤더 사용
        * **행 건너뛰기**: 없음
    * **스키마**:
        * **경로** 이외의 모든 열 포함
        * 자동으로 검색된 유형 검토
    * **세부 정보 확인**:
        * 만든 후 데이터 세트 프로필 생성 안 함
4. 만든 데이터 세트를 연 다음 **탐색** 페이지를 표시하여 데이터 샘플을 확인합니다. 이 데이터는 당뇨병 검사를 받은 환자의 세부 정보를 나타냅니다. 임상 검사의 측정값을 토대로 환자가 당뇨병 확진 판정을 받을 가능성을 예측하는 모델을 학습시키는 데 이 데이터를 사용하게 됩니다.

    > **참고**: 필요에 따라 데이터 세트의 *프로필*을 생성하여 통계 세부 정보를 추가로 확인할 수도 있습니다.

## 자동화된 Machine Learning 실험 실행

*실험*은 Azure Machine Learning에서 실행하는 작업입니다. 자동화된 Machine Learning을 사용하여 당뇨병 진단 결과를 예측하는 분류 모델을 학습시키는 실험을 실행하려면 다음 단계를 수행합니다.

1. Azure Machine Learning Studio에서 **자동화된 ML** 페이지의 **작성자** 아래 부분을 확인합니다.
2. 다음 설정을 사용하여 새 자동화된 ML 실행을 만듭니다.
    - **데이터 세트 선택**:
        - **데이터 세트**: diabetes dataset
    - **실행 구성**:
        - **새 실험 이름**: mslearn-automl-diabetes
        - **대상 열**: Diabetic(*예측하기 위해 모델을 학습시키는 레이블)*
        - **컴퓨팅 클러스터 선택**: *이전에 만든 컴퓨팅 클러스터*
    - **작업 유형 및 설정**:
        - **작업 유형**: 분류
        - **추가 구성 설정:**
            - **기본 메트릭**: **AUC_Weighted** 선택 *(뒷부분에서 이 메트릭에 대해 자세히 살펴볼 예정)*
            - **최적 모델 설명**: 선택 - *이 옵션을 선택하면 자동화된 Machine Learning 기능이 최적 모델의 기능 중요도를 계산합니다. 이를 통해 예측된 레이블에 각 기능이 미치는 영향을 확인할 수 있습니다.*
            - **차단된 알고리즘**: 모든 알고리즘을 선택한 상태로 유지
            - **종료 기준**:
                - **학습 작업 시간(시간)**: 0.25 - *최대 15분 후에 실험이 종료됩니다.*
                - **메트릭 점수 임계값**: 0.90 - *모델이 정규화된 제곱 평균 오차 메트릭 점수 0.08 이하에 도달하는 경우 실험이 종료됩니다.*
        - **기능화 설정:**
            - **기능화 사용**: 선택 - *Azure Machine Learning에서 학습 전에 자동으로 기능을 전처리합니다.*

3. 자동화된 ML 실행 세부 정보의 제출을 완료하면 자동으로 시작됩니다. **속성** 창에서 실행 상태를 관찰할 수 있습니다.
4. 실행 상태가 *실행 중*으로 변경되면 **모델** 탭에서 학습 알고리즘과 전처리 단계의 가능한 각 조합이 시도되고 결과 모델의 성능이 평가되는지 관찰합니다. 이 페이지는 주기적으로 자동으로 새로 고쳐지지만 **&#8635; 새로 고침**을 선택할 수도 있습니다. 클러스터 노드를 초기화하고 데이터 기능화 프로세스를 완료해야 학습을 시작할 수 있으므로 모델이 표시되는 데 10분 정도 걸릴 수 있습니다. 따라서 지금 잠깐 쉬어가는 것이 좋을 수 있습니다.
5. 실험이 완료될 때까지 기다립니다.

## 최적 모델 검토

실험을 완료한 후 생성된 최적 모델을 검토할 수 있습니다. 이 경우에는 종료 조건을 사용하여 실험을 중지했습니다. 따라서 실험에서 발견한 "최적" 모델이 가장 적합한 모델이 아니고 이 연습에 허용되는 시간 및 메트릭 제약 조건 범위 내에서 확인된 최적 모델에 불과할 수 있습니다.

1. 자동화된 Machine Learning 실행의 **세부 정보** 탭에서 최적 모델 요약을 확인합니다.
2. 최적 모델의 **알고리즘 이름**을 선택하여 해당 모델이 생성된 하위 실행을 확인합니다.

    지정한 평가 메트릭(*AUC_Weighted*)을 기준으로 하여 최적 모델을 확인합니다. 이 메트릭을 계산하기 위해 학습 프로세스에서는 일부 데이터를 사용하여 모델을 학습시키고, *교차 유효성 검사*라는 기술을 적용하여 학습시킨 모델을 학습되지 않은 데이터로 반복적으로 테스트하고 예측 값을 실제 알려진 값과 비교했습니다. 이러한 비교 결과를 토대로 하여 진양성, 가양성, 참 부정 및 거짓 부정이 포함된 *오차 행렬*이 표 형식으로 작성되며 추가 분류 메트릭이 계산됩니다. 예를 들어 진양성 비율과 가양성 비율을 비교하는 ROC(Receiving Operator Curve) 차트 등이 생성됩니다. 이 곡선 아래 영역(AUC)에는 분류 성능 평가에 사용되는 일반 메트릭이 표시됩니다.
3. *AUC_Weighted* 값 옆에 있는 **다른 모든 메트릭 보기**를 선택하여 분류 모델에 대한 가능한 다른 평가 메트릭 값을 확인합니다.
4. **메트릭** 탭을 선택하여 모델과 관련하여 확인할 수 있는 성능 메트릭을 검토합니다. 이 탭에서는 유효성을 검사한 모델의 오차 행렬이 표시되는 **confusion_matrix** 시각화, 그리고 ROC 차트가 포함된 **accuracy_table** 시각화 등을 확인할 수 있습니다.
5. **설명** 탭을 선택하고 **글로벌 중요도** 차트를 확인합니다. 이 차트에는 데이터 세트의 각 기능이 레이블 예측에 영향을 주는 범위가 표시됩니다.

## 예측 서비스 배포

자동화된 Machine Learning을 사용하여 일부 모델을 학습시킨 후에는 클라이언트 애플리케이션에서 사용할 수 있는 최상의 모델을 서비스로 배포할 수 있습니다.

> **참고**: Azure Machine Learning에서 서비스를 ACI(Azure Container Instances) 또는 AKS(Azure Kubernetes Service) 클러스터로 배포할 수 있습니다. 프로덕션 시나리오의 경우 AKS를 배포하는 것이 좋습니다 .이 경우 *유추 클러스터* 컴퓨팅 대상을 만들어야 합니다. 이 연습에서는 테스트에 적합한 배포 대상인 ACI 서비스를 사용하며, 유추 클러스터를 만들 필요가 없습니다.

1. 최적 모델이 생성된 실행의 **세부 정보** 탭을 선택합니다.
2. **배포** 단추를 사용하여 다음 설정으로 모델을 배포합니다.
    - **이름**: auto-predict-diabetes
    - **설명**: Predict diabetes
    - **컴퓨팅 형식**: ACI
    - **인증 사용**: 선택
3. 배포가 시작될 때까지 대기합니다. 이 작업에는 몇 초 정도 걸릴 수 있습니다. 그런 다음 **모델** 탭의 **모델 요약** 섹션에서 **auto-predict-diabetes** 서비스의 **배포 상태**를 관찰합니다. 배포 상태는 **실행 중**이어야 합니다. 이 상태가 **성공**으로 변경될 때까지 기다립니다. 주기적으로 **&#8635; 새로 고침**을 선택해야 할 수도 있습니다.
4. Azure Machine Learning Studio에서 **엔드포인트** 페이지를 표시한 다음 **auto-predict-diabetes** 실시간 엔드포인트를 선택합니다. 그런 다음 **사용** 탭을 선택하고 다음 정보를 확인합니다. 클라이언트 애플리케이션에서 배포된 서비스를 연결하려면 이 정보가 필요합니다.
    - 서비스에 대한 REST 엔드포인트
    - 서비스에 대한 기본 키
5. 이 값 옆에 있는 &#10697; 링크를 사용하여 이를 클립보드에 복사할 수 있습니다.

## 배포된 서비스 테스트

이제 서비스를 배포했으므로 간단한 코드를 사용하여 테스트할 수 있습니다.

1. 브라우저에서 **auto-predict-diabetes** 서비스 페이지의 **사용** 페이지가 열린 상태에서 새 브라우저 탭을 열고 Azure Machine Learning Studio의 두 번째 인스턴스를 엽니다. 그런 다음 새 탭에 Notebooks 페이지를 표시합니다.
2. **Notebooks** 페이지의 **내 파일** 아래에서 Notebook 리포지토리를 복제한 **Users/mslearn-dp100** 폴더로 이동하여 **Get AutoML Prediction** Notebook을 엽니다.
3. Notebook이 열리면 **컴퓨팅** 상자에서 이전에 만든 컴퓨팅 인스턴스가 선택되어 있는지와 해당 인스턴스의 상태가 **실행 중**인지 확인합니다.
4. Notebook에서 **ENDPOINT** 및 **PRIMARY_KEY** 자리 표시자를 서비스의 값으로 바꿉니다. 엔드포인트 페이지의 **사용** 탭에서 이러한 값을 복사할 수 있습니다.
5. 코드 셀을 실행하여 웹 서비스에서 반환된 출력을 확인합니다.

## 정리

이 랩에서 만든 웹 서비스는 *Azure Container Instance*에서 호스트됩니다. 추가 실험 의사가 없는 경우 불필요한 Azure 사용이 발생하지 않도록 엔드포인트를 삭제해야 합니다. 또한 다시 필요할 때까지 컴퓨팅 인스턴스를 중지해야 합니다.

1. Azure Machine Learning Studio의 **엔드포인트** 탭에서 **auto-predict-diabetes** 엔드포인트를 선택합니다. 그런 다음 **삭제**(&#128465;)를 선택하고 엔드포인트 삭제를 확인합니다.
2. **컴퓨팅** 페이지의 **컴퓨팅 인스턴스** 탭에서 컴퓨팅 인스턴스를 선택하고 **중지**를 선택합니다.
